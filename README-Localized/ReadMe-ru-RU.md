# <a name="archived-office-add-in-that-uses-the-oauthio-service-to-get-authorization-to-external-services"></a>[АРХИВИРОВАНО] Надстройка Office, которая использует службу OAuth.io для авторизации во внешних службах

> **Примечание.** Этот репозиторий заархивирован и больше активно не поддерживается. В проекте (или его зависимостях) могут присутствовать уязвимости системы безопасности. Если вы планируете повторно использовать или выполнять какой-либо код из этого репозитория, обязательно сначала выполните соответствующие проверки безопасности в коде или зависимостях. Не используйте этот проект в качестве отправной точки для создания рабочей надстройки Office. Всегда начинайте создание рабочего кода, используя рабочую нагрузку разработки для Office или SharePoint в Visual Studio или [генератор Yeoman для надстроек Office](https://github.com/OfficeDev/generator-office), и следуйте рекомендациям по безопасности при разработке надстройки.

Служба OAuth.io упрощает получение маркеров доступа OAuth 2.0 от популярных веб-служб, таких как Facebook и Google. В этом примере показано, как пользоваться этой службой в надстройке Office. 

## <a name="table-of-contents"></a>Содержание
* [История изменений](#change-history)
* [Необходимые компоненты](#prerequisites)
* [Настройка проекта](#configure-the-project)
* [Загрузка библиотеки JavaScript OAuth.io](#download-the-oauth-io-javascript-library)
* [Создание проекта Google](#create-a-google-project)
* [Создание приложения для Facebook](#create-a-facebook-app)
* [Создание приложения OAuth.io и настройка его для использования Google и Facebook](#create-an-OAuth-io-app-and-configure-it-to-use-google-and-facebook)
* [Добавление в пример кода открытого ключа](#add-the-public-key-to-the-sample-code)
* [Развертывание надстройки](#deploy-the-add-in)
* [Запуск проекта](#run-the-project)
* [Запуск надстройки](#start-the-add-in)
* [Тестирование надстройки](#test-the-add-in)
* [Вопросы и комментарии](#questions-and-comments)
* [Дополнительные ресурсы](#additional-resources)

## <a name="change-history"></a>Журнал изменений

5 января 2017 г.

* Исходная версия.

## <a name="prerequisites"></a>Необходимые условия

* Учетная запись для [OAuth.io](https://oauth.io/home).
* Учетные записи разработчика для [Google](https://developers.google.com/) и [Facebook](https://developers.facebook.com/).
* Word 2016 для Windows, сборка 16.0.6727.1000 или более поздней версии.
* [Node и npm.](https://nodejs.org/en/) В этом проекте npm используется как диспетчер пакетов и как средство запуска задач. В качестве веб-сервера используется Lite Server. Надстройка размещается на нем во время разработки, чтобы ее можно было быстро настроить и запустить. Вы можете использовать другое средство запуска задач или другой веб-сервер.
* [Git Bash](https://git-scm.com/downloads) (или другой клиент git).

## <a name="configure-the-project"></a>Настройка проекта

В папке проекта выполните следующие команды в консоли git bash:

1. ```git clone {URL of this repo}```, чтобы клонировать этот репозиторий на локальный компьютер.
2. ```npm install```, чтобы установить все детализированные зависимости в файл package.json.
3. ```bash gen-cert.sh```, чтобы создать сертификат, необходимый для запуска этого примера. 

Сделайте сертификат доверенным корневым центром. Для этого на компьютере с Windows выполните указанные ниже действия.

1. В папке репозитория на локальном компьютере дважды щелкните файл ca.crt и выберите элемент **Установить сертификат**. 
2. Выберите **Локальный компьютер** и нажмите кнопку **Далее**, чтобы продолжить. 
3. Выберите **Поместить все сертификаты в следующее хранилище** и нажмите кнопку **Обзор**.
4. Выберите **Доверенные корневые центры сертификации** и нажмите кнопку **ОК**. 
5. Нажмите кнопки **Далее** и **Готово**. 

## <a name="download-the-oauthio-javascript-library"></a>Загрузка библиотеки JavaScript OAuth.io

2. В проекте создайте папку OAuth.io в папке "Scripts" (Скрипты).
3. Скачайте библиотеку JavaScript OAuth.io из [oauth-js](https://github.com/oauth-io/oauth-js).
2. В папке \dist библиотеки скопируйте oauth.js или oauth.min.js в папку \Scripts\OAuth.io проекта. 
3. Если на предыдущем этапе вы выбрали oauth.min.js, откройте файл \Scripts\popupRedirect.js и замените `url: 'Scripts/OAuth.io/oauth.js',` строкой `url: 'Scripts/OAuth.io/oauth.min.js',`.

## <a name="create-a-google-project"></a>Создание проекта Google

1. Откройте [консоль разработки решений для Google](https://console.developers.google.com/apis/dashboard) и создайте проект **Office Add-in** (Надстройка Office).
2. Включите для проекта Google+ API. Подробные сведения приведены в справке Google.
3. Создайте учетные данные приложения для проекта, выбрав тип учетных данных **ИД клиента OAuth** и тип приложения **Веб-приложение**. Введите "Office-Add-in-OAuth.io" в поле **Имя** для клиента (а также в качестве имени продукта, если вам будет предложено его указать).
4. В разделе **Разрешенные URI перенаправления** укажите ```https://oauth.io/auth```.
5. Скопируйте назначенные секрет клиента и идентификатор клиента.

## <a name="create-a-facebook-app"></a>Создание приложения для Facebook

1. Откройте [информационную панель разработчика решений для Facebook](https://developers.facebook.com/) и создайте приложение **Надстройка Office**. Подробные сведения приведены в справке Facebook.
3. Скопируйте назначенные секрет клиента и идентификатор клиента. 
4. Укажите ```oauth.io``` в поле **Домены приложений** и задайте для параметра **URL-адрес веб-сайта** значение ```https://oauth.io/```. 

## <a name="create-an-oauthio-app-and-configure-it-to-use-google-and-facebook"></a>Создание приложения OAuth.io и настройка его для использования Google и Facebook

1. На информационной панели OAuth.io создайте приложение и запишите **открытый ключ**, который OAuth.io назначит.
3. Если он пока не указан, добавьте `localhost` в список разрешенных URL-адресов для приложения.
2. Добавьте **Google+** в качестве поставщика, или интегрированного API, для приложения. Укажите идентификатор и секрет клиента, полученные при создании проекта Google, а затем укажите `profile` в качестве **области**. Если конфигурация поставщика (интегрированного API) не сохраняется в Internet Explorer, попробуйте открыть информационную панель OAuth.io в другом браузере.
3. Повторите предыдущее действие для **Facebook**, но в качестве **области** укажите `user_about_me`.

## <a name="add-the-public-key-to-the-sample-code"></a>Добавление открытого ключа в пример кода

В файле popup.js вызывается API `OAuth.initialize`. Найдите строку и передайте открытый ключ, полученный при выполнении действий из предыдущего раздела, в качестве строки для этой функции.

## <a name="deploy-the-add-in"></a>Развертывание надстройки

Теперь необходимо сообщить Microsoft Word, где находится эта надстройка.

1. Создайте сетевую папку или [предоставьте общий доступ к папке через сеть](https://technet.microsoft.com/ru-ru/library/cc770880.aspx).
2. Поместите копию файла манифеста Office-Add-in-OAuth.io.xml из корня проекта в общую папку.
3. Запустите Word и откройте документ.
4. Перейдите на вкладку **Файл**, а затем выберите **Параметры**.
5. Выберите **Центр управления безопасностью**, а затем нажмите кнопку **Параметры центра управления безопасностью**.
6. Выберите пункт **Доверенные каталоги надстроек**.
7. В поле **URL-адрес каталога** введите сетевой путь к общей папке с файлом Office-Add-in-OAuth.io.xml и нажмите кнопку **Добавить каталог**.
8. Установите флажок **Показывать в меню** и нажмите кнопку **ОК**.
9. Появится сообщение, информирующее о том, что параметры будут применены при следующем запуске Microsoft Office. Закройте Word.

## <a name="run-the-project"></a>Запуск проекта

1. Откройте командное окно узла в папке проекта и запустите ```npm start``` для запуска веб-службы. Не закрывайте командное окно.
2. Откройте Internet Explorer или Microsoft Edge и введите ```https://localhost:3000``` в адресной строке. Если вы не получите никаких предупреждений о сертификате, закройте браузер и перейдите к приведенному ниже разделу под названием **Запуск надстройки**. Если вы получите предупреждение, что сертификат не является доверенным, выполните указанные ниже действия.
3. Несмотря на предупреждение в браузере отобразится ссылка на открытие страницы. Откройте ее.
4. После открытия страницы в адресной строке появится оповещение об ошибке сертификата красного цвета. Дважды щелкните это оповещение.
5. Выберите элемент **Просмотр сертификата**.
5. Нажмите **Установить сертификат**.
4. Выберите **Локальный компьютер** и нажмите кнопку **Далее**, чтобы продолжить. 
3. Выберите **Поместить все сертификаты в следующее хранилище** и нажмите кнопку **Обзор**.
4. Выберите **Доверенные корневые центры сертификации** и нажмите кнопку **ОК**. 
5. Выберите **Далее**, а затем **Готово**.
6. Закройте браузер.

## <a name="start-the-add-in"></a>Запуск надстройки

1. Перезапустите Word и откройте документ Word.
2. На вкладке **Вставка** в Word 2016 выберите **Мои надстройки**.
3. Откройте вкладку **Общая папка**.
4. Выберите **Auth with OAuthIO** (Авторизация с помощью OAuthIO) и нажмите кнопку **ОК**.
5. Если ваша версия Word поддерживает команды надстроек, то в пользовательском интерфейсе появятся сведения о том, что надстройка загружена.
6. На вкладке "Главная" появится новая группа под названием **OAuth.io** с кнопкой **Показать** и значком. Нажмите эту кнопку, чтобы открыть надстройку.

 > Примечание. Если ваша версия Word не поддерживает команды надстроек, то надстройка загрузится в области задач.

## <a name="test-the-add-in"></a>Тестирование надстройки

1. Нажмите кнопку **Get Facebook Name** (Получить имя Facebook).
2. Откроется всплывающее окно, и вам будет предложено выполнить вход с помощью учетной записи Facebook (если вы пока этого не сделали).
3. Когда вы войдете, в документ Word вставится ваше имя пользователя Facebook.
4. Повторите описанные выше шаги, нажав кнопку **Get Google Name** (Получить имя Google).

## <a name="questions-and-comments"></a>Вопросы и комментарии

Мы будем рады узнать ваше мнение об этом примере. Своими мыслями можете поделиться на вкладке *Issues* (Проблемы) этого репозитория.

Общие вопросы о разработке решений для Microsoft Office 365 следует задавать на сайте [Stack Overflow](http://stackoverflow.com/questions/tagged/office-js+API). Если ваш вопрос касается API JavaScript для Office, добавьте к нему теги [office-js] и [API].

## <a name="additional-resources"></a>Дополнительные ресурсы

* 
  [Документация по надстройкам Office](https://msdn.microsoft.com/ru-ru/library/office/jj220060.aspx)
* [Центр разработки для Office](http://dev.office.com/)
* Другие примеры надстроек Office см. на странице [OfficeDev на Github](https://github.com/officedev).

## <a name="copyright"></a>Авторское право
© Корпорация Майкрософт (Microsoft Corporation), 2017. Все права защищены.

